<app-header></app-header>
<div class="divbackground pb-5">
  <div class="container px-0">
    <div class="imgstyles pt-5 pb-4">
      <img src="../../assets/rules icon.png" alt="rules-logo" /> RULES
    </div>
    <div class="box-shadow">
      <div class="row">
        <div class="col-3 d-flex align-items-center">
          <label for="fil" class="filter mx-3 font-size-m">Filter by</label>
          <select [(ngModel)]="selectedOption" (ngModelChange)="changeRuleType($event)" style="width: 40%; padding: 5px"
            class="form-select">
            <option value="Default">Default</option>
            <option value="Custom">Custom</option>
          </select>
        </div>
        <div class="col-3 d-flex align-items-center">
          <label for="fil" class="filter mx-3 font-size-m">Number of pages</label>
          <select [(ngModel)]="noOfPages" (ngModelChange)="noOfPagesChange()" style="width:auto" class="form-select">
            <option *ngFor="let in of counter(noOfPagesLength); let i = index" [value]="i + 1"> {{ i + 1 }}
            </option>
          </select>

        </div>
        <div class="col-5 d-grid gap-4 d-md-flex justify-content-md-end m-2" *ngIf="isAdmin ==='Yes'">
          <button type="button" class="btn btn-primary bgcolor" [disabled]="!selectedRuleIds.length"
            (click)="enableRules(true)">
            Enable
          </button>
          <button type="button" class="btn btn-primary bgcolor" [disabled]="!selectedRuleIds.length"
            (click)="enableRules(false)">
            Disable
          </button>
          <button type="button" class="btn btn-primary bgcolor" (click)="openAddRuleModal(true)">
            New rules
          </button>
          <div class="dropdown editDotsStyle" *ngIf="selectedOption == 'Custom'">
            <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton1"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-ellipsis-h"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <li>
                <a class="dropdown-item" (click)="openAddRuleModal(false)">Edit</a>
              </li>
              <li>
                <a class="dropdown-item" (click)="openDeleteModal()">Delete</a>
              </li>
            </ul>
          </div>

        </div>
      </div>
      <!-- Default Rules -->
      <div *ngIf="selectedOption == 'Default'">
        <p-table [value]="rules" styleClass="p-datatable-striped" [paginator]="true" [rows]="30"
          responsiveLayout="scroll" [(first)]="first" (onPage)="paginate($event)">
          <ng-template pTemplate="header">
            <tr class="headerstyle">
              <th class="textstyle">
                <p-tableHeaderCheckbox #checkall (click)="selectAll(checkall)"></p-tableHeaderCheckbox>
              </th>
              <th class="textstyle w--30 ">Rules</th>
              <th class="textstyle w--10">Action</th>
              <th class="textstyle w--40 text-center">Description</th>
              <th class="textstyle">Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rule class="bodyStyle" let-index="rowIndex">
            <tr class="row-bg" [ngClass]="{
                selectedcolor: rule.selected == true
              }">
              <td>
                <p-tableCheckbox [value]="rule" #checkbox (click)="checkRow(rule, checkbox , index)"></p-tableCheckbox>
              </td>
              <td>{{ rule.rule_name }}</td>
              <td>{{ rule.action }}</td>
              <td>{{ rule.rule_description }}</td>
              <td *ngIf="rule.enabled">
                <span class="enablestyle" style="color:#34B233">Enabled</span>
              </td>
              <td *ngIf="!rule.enabled">
                <span class="enablestyle" style="color:#FF4500">Disabled</span>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

      <!-- custom Rules -->
      <div *ngIf="selectedOption == 'Custom'">
        <p-table [value]="rules" styleClass="p-datatable-striped" [paginator]="true" [rows]="30" [(first)]="first"
          (onPage)="paginate($event)">
          <ng-template pTemplate="header">
            <tr class="headerstyle">
              <th>
                <p-tableHeaderCheckbox #checkall (click)="selectAll(checkall)"></p-tableHeaderCheckbox>
              </th>
              <th class="textstyle">Pattern</th>
              <th class="textstyle">Action</th>
              <th class="textstyle text-center">Description</th>
              <th class="textstyle">Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-rule class="bodyStyle" let-index="rowIndex">
            <tr class="row-bg" [ngClass]="{
              selectedcolor: rule.selected == true
            }">
              <td>
                <p-tableCheckbox [value]="rule" #checkbox (click)="checkRow(rule, checkbox, index)"></p-tableCheckbox>
              </td>
              <td>{{ trimMethodForDescription(rule.rule_name)
                }}</td>
              <td>{{ rule.action }}</td>
              <td>{{ trimMethodForDescription(rule.rule_description)
                }}</td>
              <td *ngIf="rule.enabled">
                <span class="enablestyle" style="color:#34B233">Enabled</span>
              </td>
              <td *ngIf="!rule.enabled">
                <span class="enablestyle" style="color:#FF4500">Disabled</span>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <!-- modals -->
    <div class="modal fade" id="viewActionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">View Action</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Enable on logs bcmd:swlog appid bcmd subapp 3 level debug2 Enable on
            logs bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2 Enable on logs
            bcmd:swlog appid bcmd subapp 3 level debug2
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal">
              Ok
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="enableModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="p-3 d-flex justify-content-between">
            <div></div>
            <h5 class="modal-title rulecolor font-size-l" id="exampleModalLabel">Confirmation</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="font-size-m"> Do you want to {{ enableRuleData?.enabled ? 'enable' : 'disable'}} the selected
              pattern? </p>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-light border" (click)="enableSingleRule(rules,enableRuleData)">
              Yes
            </button>
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal">
              No
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="hintModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="p-3 d-flex justify-content-between">
            <h5 class="modal-title rulecolor font-size-l" id="exampleModalLabel">Confirmation</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="font-size-l"> Please select at least one pattern </p>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="editModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="p-3 d-flex justify-content-between">
            <h5 class="modal-title rulecolor font-size-l" id="exampleModalLabel">
              Edit Custom Pattern
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form [formGroup]="editForm">
              <div class="row pb-2">
                <div class="col-3"><label>Pattern Name:</label></div>
                <div class="col-9">
                  <input type="text" name="patternname" formControlName="rule_name" />
                  <input type="text" name="ruleId" formControlName="rule_id" />
                </div>
              </div>

              <div class="row pb-2">
                <div class="col-3"><label>Action: </label></div>
                <div class="col-9">
                  <select formControlName="action">
                    <option value="Collect log">Collect Logs</option>
                    <option value="Send Notification">Send Notification</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-3">
                  <label for="notification">Notification Message: </label>
                </div>
                <div class="col-9">
                  <textarea name="message" rows="5" cols="30" formControlName="description"></textarea>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" [disabled]="!editForm.valid"
              (click)="editRule()">
              Save Changes
            </button>
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="deletefailuerModel" tabindex="-1" aria-labelledby="exampleModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header fail">
            <div class="row col-12">
              <div class="col-5"></div>
              <div class="col-1">
                <i class="far fa-times-circle failicon"></i>
              </div>
              <div class="col-5"></div>
              <div class="col-1">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
            </div>
          </div>
          <div class="modal-body">
            <h4 class="sorrystyle">Sorry!</h4>
            <p style="text-align: center">
              Your rule was not removed. Please try again.
            </p>
          </div>
          <div class="d-flex justify-content-center mb-5">
            <button type="button" class="btn border" data-bs-dismiss="modal">
              BACK TO MY WORK
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="addRuleModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="d-flex justify-content-end p-3">
            <!-- <h5 class="modal-title rulecolor" id="exampleModalLabel">NEW RULES</h5> -->
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex justify-content-center">
              <h5 class="modal-title rulecolor font-size-l" id="exampleModalLabel">
                {{ addRule ? 'ADD NEW RULE' : 'Edit Custom Pattern' }}
              </h5>
            </div>
            <form [formGroup]="newRuleForm">
              <div class="row pb-2">
                <div class="col-12">
                  <label class="rulecolor font-size-m">Create a new rule</label>
                </div>
                <div class="col-12">
                  <input type="text" class="borderStyle inputcolor form-control" name="rule_name"
                    formControlName="rule_name" maxlength="255" />
                </div>
              </div>

              <div class="row py-3">
                <div class="col-12">
                  <label for="notification" class="rulecolor font-size-m">Description
                  </label>
                </div>
                <div class="col-12">
                  <input type="text" name="message" class="borderStyle inputcolor form-control"
                    formControlName="description" />
                </div>
              </div>

              <div class="row py-3">
                <div class="col-12">
                  <label class="rulecolor font-size-m">Actions</label>
                </div>
                <div class="col-12">
                  <select class="form-select" id="action" name="action" formControlName="action">
                    <option value="" disabled selected>-None-</option>
                    <option value="Increase log verbosity">Increase log verbosity</option>
                    <option value="Send Notification">Send Notification</option>
                    <option value="Collect log and send notification">Collect log and send notification</option>
                  </select>
                </div>
              </div>

              <div class="row py-3" *ngIf="newRuleForm.value.action == 'sendNotification'">
                <div class="col-12">
                  <label class="message">Notification Message</label>
                  <textarea class="form-control" rows="5" id="comment"></textarea>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-primary border" data-bs-dismiss="modal" [disabled]="!newRuleForm.valid"
              (click)="createRule()">
              {{ addRule ? 'Save' : 'Save Changes' }}
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="deleteModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg delete-model">
        <div class="modal-content">
          <div class="d-flex justify-content-between p-3">
            <div></div>
            <h5 class="modal-title rulecolor font-size-l" id="exampleModalLabel">Delete Rule</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="font-size-m"> Are you sure you want to delete? </p>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-light border" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="button" class="btn btn-primary border" data-bs-dismiss="modal" (click)="deleteRule()">
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>